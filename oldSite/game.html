<!DOCTYPE html>
<html>
    <head>
        <style>
            .box{
                background-color: darkolivegreen;
                margin: 0px;
                padding: 0px;
                border: 1px solid black;
                transition:all .2s;
                z-index: 1;
                max-width: 6vh;
            }
            .box:hover{
                background-color: green;
            }
            .b{
                background-color: red;
            }
            #gameContainer{
                display: flex;
            }
            body{
                overflow: hidden;
                background-color: black;
            }
            html{
                user-select: none;
            }
        </style>
    </head>
    <body style="width: 100vw; height: 100vh; margin: 0px; padding: 0px;">
        <div style="margin-left: auto; margin-right: auto; padding: 0px; width: min-content">
                <h3 style="color: white; text-align: center;">Level:<div id="level"></div></h3>
            <div id="gameContainer"></div>
        </div>
    </body>
    <script>

        let isClick = false;
        let level = 0;
        let prevTouchElem = '';

        document.addEventListener('mousedown',()=>{isClick = true;})
        document.addEventListener('mouseup',()=>{isClick = false;})
        document.addEventListener('touchend',()=>{isClick = false;})

        let gameContainer = document.querySelector('#gameContainer');
        //let dimension = [Math.floor(window.innerWidth/20) ,Math.floor(window.innerHeight/20)]
        let dimension = [10,10];

        let squares = [];
        for( i = 0; i < dimension[0]; i++ ){
            let tmpRow = document.createElement('div');
            tmpRow.classList.add('row');
            for(a = 0; a < dimension[1]; a++){
                let tmp = document.createElement('div');
                tmp.style.width = "9vw";
                tmp.style.paddingBottom = "100%";
                tmp.classList.add('box');
                tmp.setAttribute('pos',`${i},${a}`);
                tmp.addEventListener('mouseenter', boxTouchActivate );
                tmp.addEventListener('touchstart', (e)=>{e.preventDefault(); isClick=true;boxTouchActivate(e);} );
                tmp.addEventListener('touchmove', boxTouchActivate );
                tmp.addEventListener('mousedown', (e)=>{isClick = true;boxTouchActivate(e)} );
                tmpRow.appendChild(tmp);
            }
            gameContainer.appendChild(tmpRow);
        }

        let boxes = document.querySelectorAll('.box');

        function boxAcivate(e){
            let initialPos = e.target.getAttribute('pos');
            initialPos = initialPos.split(',');
            if(e.synthetic === true){
                if((initialPos[0] > 0 && initialPos[0] < dimension[0]-1) && ( initialPos[1] > 0 && initialPos[1] < dimension[1]-1 ) ){
                    let posCheck = [`${initialPos[0]-1},${initialPos[1]}`,
                        `${initialPos[0]-(-1)},${initialPos[1]}`,
                        `${initialPos[0]},${initialPos[1]-1}`,
                        `${initialPos[0]},${initialPos[1]-(-1)}`]
                        // console.log(boxes.filter( (e)=>{posCheck.includes(e.pos)} ));
                        boxes.forEach( (a)=>{
                            posCheck.forEach( (z)=>{
                                if(z == a.getAttribute('pos')){
                                    a.classList.toggle('b');
                                }
                            } )
                        } )
                        e.target.classList.toggle('b');
                    if(document.querySelectorAll('.b').length == 0){
                        init();
                    }
                }
            }else{
                if(isClick && (initialPos[0] > 0 && initialPos[0] < dimension[0]-1) && ( initialPos[1] > 0 && initialPos[1] < dimension[1]-1 ) ){
                    let posCheck = [`${initialPos[0]-1},${initialPos[1]}`,
                        `${initialPos[0]-(-1)},${initialPos[1]}`,
                        `${initialPos[0]},${initialPos[1]-1}`,
                        `${initialPos[0]},${initialPos[1]-(-1)}`]
                        // console.log(boxes.filter( (e)=>{posCheck.includes(e.pos)} ));
                        boxes.forEach( (a)=>{
                            posCheck.forEach( (z)=>{
                                if(z == a.getAttribute('pos')){
                                    a.classList.toggle('b');
                                }
                            } )
                        } )
                        e.target.classList.toggle('b');
                    if(document.querySelectorAll('.b').length == 0){
                        init();
                    }
                }
            }
        }

        function boxTouchActivate(e){
            tmp={};
            if(e.touches != undefined){
                tmp.target = document.elementFromPoint( e.touches[0].clientX,e.touches[0].clientY );
                if(tmp.target != prevTouchElem){
                    boxAcivate(tmp);
                    prevTouchElem = tmp.target;
                }
            }else{
                tmp.target = e.target;
                if(tmp.target != prevTouchElem && isClick == true){
                    boxAcivate(tmp);
                    prevTouchElem = tmp.target;
                }
            }
        }

        function synthBoxActivate(e){
            e.synthetic = true;
            boxAcivate(e);
        }

        function init(){
            level++;
            document.querySelector('#level').innerText = level;
            for(i = 0; i < level; i++){
                let tmp = {};
                tmp.target = boxes[ Math.round(Math.random()*(dimension[0]*dimension[1]))];
                tmp.splitPos = tmp.target.getAttribute('pos').split(',');
                if(tmp.splitPos[0] == 0 || tmp.splitPos[0] == 9 || tmp.splitPos[1] == 0 || tmp.splitPos[1] == 9){
                    i--;
                }
                synthBoxActivate(tmp)
            }
        }
        init();
    </script>
</html>
