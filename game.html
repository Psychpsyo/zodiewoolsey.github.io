<!DOCTYPE html>
<html>
    <link rel="stylesheet" href="Style.css">
    <script language="javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
    <script language="javascript" src="jqinput/jquery.hotkeys.js" type="text/javascript"></script>
    <script language="javascript" src="jqinput/key_status.js" type="text/javascript"></script>
    <script language="javascript" src="jqinput/util.js" type="text/javascript"></script>
    <script language="javascript" src="jqinput/sprite.js" type="text/javascript"></script>
    <script language="javascript" src="jqinput/sound.js" type="text/javascript"></script>
    <head><div class="pageHeader">
        Game
        </div></head>
    <body>
        <canvas id="canvas" style="border: 1px solid;"></canvas>
        <script>
            var c = document.getElementById("canvas");
            var ctx = c.getContext("2d");
            
            var oldTime = Date.now();
            
            c.width = 500;
            c.height = 500;
            
            var turn;
            var score;
            var enemies;
            var bullets;
            var shoot;
            
            function init(){
                turn = 0;
                score = 0;
                enemies = [];
                bullets = [];
                shoot = true;
                
            };
            init();
            
            function createBullet(x, y){
                var bullet = {};
                bullet.x = x;
                bullet.y = y;
                bullet.go = function(){
                        ctx.fillRect(bullet.x,bullet.y,10,2);
                        bullet.y--;
                };
                bullet.collide = function(){
                    var x = bullet.x;
                    var y = bullet.y;
                        if ((enemies[i].x > bullet.x-10 && enemies[i].x < bullet.x+10) && (enemies[i].y > bullet.y-10 && enemies[i].y < bullet.y+10)){
                            enemies.forEach()
                            console.log("hit");
                        }
                }
                return bullet;
            };
            
            function createEnemy(){
                var enemy = {};
                enemy.x = Math.random()*c.width;
                enemy.y = 0-(Math.random()*500);
                enemy.dead = false;
                enemy.live = function(){
                    ctx.fillStyle = "#f00";
                    ctx.fillRect(enemy.x,enemy.y,5,5);
                    //enemy.x ++;
                    enemy.y += 1*(1+Math.random()*2);
                    if (enemy.y > c.height){
                        enemy.dead = true;
                    }
                };
                enemy.setDead = function(x, y){
                    if (enemy.x > x -10 && enemy.x < x+10 && enemy.y > y-10 && enemy.y < y+10){
                        enemy.dead = true;
                    }
                };
                return enemy;
            }
            
            /*player*/{
            var player = {};
            player.x = c.width/2;
            player.y = c.height/2;
            player.move = function(){
                if (keydown.up){
                    if (player.y > 0){
                        player.y -= 2;
                    }
                }if (keydown.down){
                    if (player.y < c.width-5){
                        player.y += 2;
                    }
                }if (keydown.left){
                    if (player.x > 0){
                        player.x -= 2;
                    }
                }if (keydown.right){
                    if (player.x < c.width-5){
                        player.x += 2;
                    }
                }if (keydown.space){
                    bullets.push(new createBullet(player.x, player.y));
                }
            };
            player.draw = function(){
                ctx.fillStyle = "#0f0";
                ctx.fillRect(player.x,player.y,10,10)
            };
            player.collide = function(){
                setInterval(function(){
                    for (i = 0; i < enemies.length; i++){
                        if ((enemies[i].x > player.x-5 && enemies[i].x < player.x+10) && (enemies[i].y > player.y && enemies[i].y < player.y+10)){
                            init();
                        }
                    }
            },0)
            }
            }
            
            player.collide();
            setInterval(function(){
                for (i = 0; i < bullets.length; i++){
                    bullets[i].collide();
                }
            },0)
            count = 50;
            
            setInterval(function(){
                if (enemies.length < count){
                    enemies.push(new createEnemy());
                };
                if ((Date.now()-oldTime) > 1000/60){
                ctx.clearRect(0,0,c.width,c.height);
                ctx.fillText(score,0,0,100,100);
                player.move();
                player.draw();
                for (b = 0; b < bullets.length; b++){
                    bullets[b].go();
                    if (bullets[b].y < 0){
                        bullets.splice(b,1);
                    }
                };
                for (a = 0; a < enemies.length; a++){
                    enemies[a].live();
                    if (enemies[a].dead == true){
                        enemies.splice(a,1);
                        //count ++;
                    }
                };
                    oldTime=Date.now();
                    score++;
                }},0)
            
        </script>
    </body>
</html>